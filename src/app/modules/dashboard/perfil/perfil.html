<div class="perfil-container">
  <div class="perfil-header">
    <h1>Mi Perfil</h1>
    <p>Administra tu información personal</p>
  </div>

  <div class="perfil-content">
    <!-- Lado Izquierdo -->
    <div class="perfil-left">
      <div class="avatar">
        <i class="bi bi-person-circle"></i>
      </div>
      <h3>{{ perfilForm.value.nombre }}</h3>
      <p class="role-badge">ADMIN</p>
    </div>

    <!-- Lado Derecho -->
    <div class="perfil-right">
      <form [formGroup]="perfilForm">
        <div class="info-section">
          <div class="info-row">
            <i class="bi bi-person"></i>
            <label>Nombre completo:</label>

            <ng-container *ngIf="!editMode; else editNombre">
              <span>{{ perfilForm.value.nombre }}</span>
            </ng-container>
            <ng-template #editNombre>
              <input type="text" formControlName="nombre" />
            </ng-template>
          </div>

          <div class="info-row">
            <i class="bi bi-envelope"></i>
            <label>Email:</label>

            <ng-container *ngIf="!editMode; else editEmail">
              <span>{{ perfilForm.value.email }}</span>
            </ng-container>
            <ng-template #editEmail>
              <input type="email" formControlName="email" />
            </ng-template>
          </div>

          <div class="info-row">
            <i class="bi bi-clock-history"></i>
            <label>Fecha de registro:</label>
            <span>{{ perfilForm.value.fecha_de_registro }}</span>
          </div>
        </div>
      </form>


      <div class="actions-section">
        <button *ngIf="!editMode" class="btn-primary" (click)="toggleEdit()">
          <i class="bi bi-pencil-square"></i> Editar Perfil
        </button>

        <div *ngIf="editMode" class="actions-section">
          <button class="btn-primary" (click)="guardarCambios()"
            [disabled]="perfilForm.invalid || !formHasChanges()">
            <i class="bi bi-check-lg"></i> Guardar
          </button>
          <button class="btn-secondary" (click)="toggleEdit()">
            <i class="bi bi-x-lg"></i> Cancelar
          </button>
        </div>

        <button *ngIf="!cambiarPassMode" class="btn-secondary" (click)="toggleCambiarPass()">
          <i class="bi bi-shield-lock"></i> Cambiar Contraseña
        </button>

        <div *ngIf="cambiarPassMode" class="password-section">
          <form [formGroup]="passwordForm">
            <div class="info-row">
              <i class="bi bi-lock"></i>
              <label>Contraseña actual:</label>
              <input type="password" formControlName="actual" />
              <div *ngIf="passwordForm.get('actual')?.hasError('required') && passwordForm.get('actual')?.touched"
                class="text-danger">
                La contraseña actual es obligatoria
              </div>
            </div>
            <div class="info-row">
              <i class="bi bi-key"></i>
              <label>Nueva contraseña:</label>
              <input type="password" formControlName="nueva" />
            </div>
            <div *ngIf="passwordForm.get('nueva')?.hasError('required') && passwordForm.get('nueva')?.touched"
              class="text-danger">
              La nueva contraseña es obligatoria
            </div>
            <div *ngIf="passwordForm.get('nueva')?.hasError('minlength') && passwordForm.get('nueva')?.touched"
              class="text-danger">
              La contraseña debe tener al menos 6 caracteres
            </div>
            <div *ngIf="passwordForm.hasError('mismaContraseña') && passwordForm.get('nueva')?.touched"
              class="text-danger">
              La nueva contraseña no puede ser igual a la actual
            </div>

            <div class="info-row">
              <i class="bi bi-shield-lock"></i>
              <label>Confirmar contraseña:</label>
              <input type="password" formControlName="confirmar" />
              <div *ngIf="passwordForm.get('confirmar')?.touched 
                  && passwordForm.get('nueva')?.value !== passwordForm.get('confirmar')?.value" class="text-danger">
                Las contraseñas no coinciden
              </div>
            </div>

            <div class="actions-section">
              <button class="btn-primary" type="submit" (click)="guardarPassword()"
                [disabled]="passwordForm.invalid || passwordForm.pristine">
                <i class="bi bi-check-lg"></i> Guardar
              </button>

              <button class="btn-secondary" (click)="toggleCambiarPass()" type="button">
                <i class="bi bi-x-lg"></i> Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>